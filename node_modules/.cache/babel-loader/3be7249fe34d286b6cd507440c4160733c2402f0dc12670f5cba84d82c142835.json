{"ast":null,"code":"// api.js — resilient version\nconst FALLBACK_LOCAL = 'http://localhost:5000/api';\nconst FALLBACK_REMOTE = 'https://tasselgroup-back.onrender.com/api';\n\n// Select base URL dynamically\nexport const getApiBaseUrl = () => {\n  var _import$meta$env;\n  const envUrl = ((_import$meta$env = import.meta.env) === null || _import$meta$env === void 0 ? void 0 : _import$meta$env.VITE_API_URL) || process.env.REACT_APP_API_URL || null;\n  if (envUrl) return envUrl;\n  const host = window.location.hostname;\n  if (host === 'localhost' || host === '127.0.0.1') return FALLBACK_LOCAL;\n  return FALLBACK_REMOTE;\n};\nconst API_BASE = getApiBaseUrl();\n\n// Generic fetch wrapper with retry + timeout\nasync function safeFetch(url, options = {}, retries = 2, timeoutMs = 10000) {\n  const controller = new AbortController();\n  const timer = setTimeout(() => controller.abort(), timeoutMs);\n  try {\n    const response = await fetch(url, {\n      ...options,\n      signal: controller.signal\n    });\n    clearTimeout(timer);\n    if (!response.ok) {\n      const errText = await response.text();\n      throw new Error(`HTTP ${response.status}: ${errText}`);\n    }\n    const contentType = response.headers.get('content-type');\n    if (contentType !== null && contentType !== void 0 && contentType.includes('application/json')) return response.json();\n    return await response.text();\n  } catch (err) {\n    if (retries > 0 && (err.name === 'AbortError' || err.message.includes('fetch'))) {\n      console.warn('Retrying request...', retries);\n      return safeFetch(url, options, retries - 1, timeoutMs);\n    }\n    throw err;\n  }\n}\n\n// Base call with error mapping\nexport const apiCall = async (endpoint, options = {}) => {\n  var _config$method;\n  const token = localStorage.getItem('token');\n  const config = {\n    headers: {\n      'Content-Type': 'application/json',\n      ...(token && {\n        Authorization: `Bearer ${token}`\n      }),\n      ...options.headers\n    },\n    ...options\n  };\n  if (config.body && !['GET', 'HEAD'].includes((_config$method = config.method) === null || _config$method === void 0 ? void 0 : _config$method.toUpperCase())) {\n    config.body = JSON.stringify(config.body);\n  }\n  try {\n    console.log(`📡 [API] → ${API_BASE}${endpoint}`);\n    return await safeFetch(`${API_BASE}${endpoint}`, config);\n  } catch (error) {\n    console.error(`❌ [API] ${endpoint}:`, error.message);\n    throw new Error(error.name === 'AbortError' ? '⏱️ Request timed out. Please retry.' : 'Cannot connect to server. Check internet or backend status.');\n  }\n};\n\n// ----- Specific API endpoints remain identical -----\nexport const apiService = {\n  // Products\n  getProducts: () => apiCall('/products'),\n  // Services\n  getServices: () => apiCall('/services'),\n  createService: d => apiCall('/services', {\n    method: 'POST',\n    body: d\n  }),\n  // Bookings\n  getBookings: (p = '') => apiCall(`/bookings${p}`),\n  createBooking: d => apiCall('/bookings', {\n    method: 'POST',\n    body: d\n  }),\n  updateBookingStatus: (id, s) => apiCall(`/bookings/${id}/status`, {\n    method: 'PATCH',\n    body: {\n      status: s\n    }\n  }),\n  assignStaffToBooking: (id, staffId) => apiCall(`/bookings/${id}/assign-staff`, {\n    method: 'PATCH',\n    body: {\n      staffId\n    }\n  }),\n  // Gifts\n  getGiftPackages: () => apiCall('/gift-packages'),\n  createGiftOrder: d => apiCall('/gift-orders', {\n    method: 'POST',\n    body: d\n  }),\n  // Orders\n  getOrders: (p = '') => apiCall(`/orders${p}`),\n  createOrder: d => apiCall('/orders', {\n    method: 'POST',\n    body: d\n  }),\n  updateOrderStatus: (id, s) => apiCall(`/orders/${id}/status`, {\n    method: 'PATCH',\n    body: {\n      status: s\n    }\n  }),\n  // Staff\n  getStaffMembers: () => apiCall('/users/staff'),\n  // Dashboard\n  getAdminDashboard: () => apiCall('/dashboard/admin'),\n  getStaffDashboard: () => apiCall('/dashboard/staff'),\n  getCustomerOrders: () => apiCall('/dashboard/orders/my-orders'),\n  getCustomerBookings: () => apiCall('/dashboard/bookings/my-bookings'),\n  getCustomerGifts: () => apiCall('/dashboard/gift-orders/my-gifts'),\n  // Payment\n  initiatePayment: d => apiCall('/payment/initiate', {\n    method: 'POST',\n    body: d\n  }),\n  createManualOrder: d => apiCall('/payment/manual-order', {\n    method: 'POST',\n    body: d\n  }),\n  // Receipts\n  generateReceipt: (t, id) => apiCall(`/dashboard/receipt/${t}/${id}`)\n};","map":{"version":3,"names":["FALLBACK_LOCAL","FALLBACK_REMOTE","getApiBaseUrl","_import$meta$env","envUrl","import","meta","env","VITE_API_URL","process","REACT_APP_API_URL","host","window","location","hostname","API_BASE","safeFetch","url","options","retries","timeoutMs","controller","AbortController","timer","setTimeout","abort","response","fetch","signal","clearTimeout","ok","errText","text","Error","status","contentType","headers","get","includes","json","err","name","message","console","warn","apiCall","endpoint","_config$method","token","localStorage","getItem","config","Authorization","body","method","toUpperCase","JSON","stringify","log","error","apiService","getProducts","getServices","createService","d","getBookings","p","createBooking","updateBookingStatus","id","s","assignStaffToBooking","staffId","getGiftPackages","createGiftOrder","getOrders","createOrder","updateOrderStatus","getStaffMembers","getAdminDashboard","getStaffDashboard","getCustomerOrders","getCustomerBookings","getCustomerGifts","initiatePayment","createManualOrder","generateReceipt","t"],"sources":["C:/tasselgroupreact/src/services/api.js"],"sourcesContent":["// api.js — resilient version\r\nconst FALLBACK_LOCAL = 'http://localhost:5000/api';\r\nconst FALLBACK_REMOTE = 'https://tasselgroup-back.onrender.com/api';\r\n\r\n// Select base URL dynamically\r\nexport const getApiBaseUrl = () => {\r\n  const envUrl =\r\n    import.meta.env?.VITE_API_URL ||\r\n    process.env.REACT_APP_API_URL ||\r\n    null;\r\n\r\n  if (envUrl) return envUrl;\r\n\r\n  const host = window.location.hostname;\r\n  if (host === 'localhost' || host === '127.0.0.1') return FALLBACK_LOCAL;\r\n  return FALLBACK_REMOTE;\r\n};\r\n\r\nconst API_BASE = getApiBaseUrl();\r\n\r\n// Generic fetch wrapper with retry + timeout\r\nasync function safeFetch(url, options = {}, retries = 2, timeoutMs = 10000) {\r\n  const controller = new AbortController();\r\n  const timer = setTimeout(() => controller.abort(), timeoutMs);\r\n\r\n  try {\r\n    const response = await fetch(url, { ...options, signal: controller.signal });\r\n    clearTimeout(timer);\r\n\r\n    if (!response.ok) {\r\n      const errText = await response.text();\r\n      throw new Error(`HTTP ${response.status}: ${errText}`);\r\n    }\r\n\r\n    const contentType = response.headers.get('content-type');\r\n    if (contentType?.includes('application/json')) return response.json();\r\n    return await response.text();\r\n\r\n  } catch (err) {\r\n    if (retries > 0 && (err.name === 'AbortError' || err.message.includes('fetch'))) {\r\n      console.warn('Retrying request...', retries);\r\n      return safeFetch(url, options, retries - 1, timeoutMs);\r\n    }\r\n    throw err;\r\n  }\r\n}\r\n\r\n// Base call with error mapping\r\nexport const apiCall = async (endpoint, options = {}) => {\r\n  const token = localStorage.getItem('token');\r\n  const config = {\r\n    headers: {\r\n      'Content-Type': 'application/json',\r\n      ...(token && { Authorization: `Bearer ${token}` }),\r\n      ...options.headers\r\n    },\r\n    ...options\r\n  };\r\n\r\n  if (config.body && !['GET', 'HEAD'].includes(config.method?.toUpperCase())) {\r\n    config.body = JSON.stringify(config.body);\r\n  }\r\n\r\n  try {\r\n    console.log(`📡 [API] → ${API_BASE}${endpoint}`);\r\n    return await safeFetch(`${API_BASE}${endpoint}`, config);\r\n  } catch (error) {\r\n    console.error(`❌ [API] ${endpoint}:`, error.message);\r\n    throw new Error(\r\n      error.name === 'AbortError'\r\n        ? '⏱️ Request timed out. Please retry.'\r\n        : 'Cannot connect to server. Check internet or backend status.'\r\n    );\r\n  }\r\n};\r\n\r\n// ----- Specific API endpoints remain identical -----\r\nexport const apiService = {\r\n  // Products\r\n  getProducts: () => apiCall('/products'),\r\n\r\n  // Services\r\n  getServices: () => apiCall('/services'),\r\n  createService: (d) => apiCall('/services', { method: 'POST', body: d }),\r\n\r\n  // Bookings\r\n  getBookings: (p = '') => apiCall(`/bookings${p}`),\r\n  createBooking: (d) => apiCall('/bookings', { method: 'POST', body: d }),\r\n  updateBookingStatus: (id, s) =>\r\n    apiCall(`/bookings/${id}/status`, { method: 'PATCH', body: { status: s } }),\r\n  assignStaffToBooking: (id, staffId) =>\r\n    apiCall(`/bookings/${id}/assign-staff`, { method: 'PATCH', body: { staffId } }),\r\n\r\n  // Gifts\r\n  getGiftPackages: () => apiCall('/gift-packages'),\r\n  createGiftOrder: (d) => apiCall('/gift-orders', { method: 'POST', body: d }),\r\n\r\n  // Orders\r\n  getOrders: (p = '') => apiCall(`/orders${p}`),\r\n  createOrder: (d) => apiCall('/orders', { method: 'POST', body: d }),\r\n  updateOrderStatus: (id, s) =>\r\n    apiCall(`/orders/${id}/status`, { method: 'PATCH', body: { status: s } }),\r\n\r\n  // Staff\r\n  getStaffMembers: () => apiCall('/users/staff'),\r\n\r\n  // Dashboard\r\n  getAdminDashboard: () => apiCall('/dashboard/admin'),\r\n  getStaffDashboard: () => apiCall('/dashboard/staff'),\r\n  getCustomerOrders: () => apiCall('/dashboard/orders/my-orders'),\r\n  getCustomerBookings: () => apiCall('/dashboard/bookings/my-bookings'),\r\n  getCustomerGifts: () => apiCall('/dashboard/gift-orders/my-gifts'),\r\n\r\n  // Payment\r\n  initiatePayment: (d) => apiCall('/payment/initiate', { method: 'POST', body: d }),\r\n  createManualOrder: (d) => apiCall('/payment/manual-order', { method: 'POST', body: d }),\r\n\r\n  // Receipts\r\n  generateReceipt: (t, id) => apiCall(`/dashboard/receipt/${t}/${id}`)\r\n};\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}